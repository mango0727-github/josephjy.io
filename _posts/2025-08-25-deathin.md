---
layout: post
title: Malware Analysis Report
subtitle: skuld by Deathined
cover-img: /assets/img/path.jpg
thumbnail-img: /assets/img/thumb.png
share-img: /assets/img/path.jpg
tags: [Reversing]
author: Joonyoung Jeong
---


# Info Stealer: skuld by Deathined

# **Analysis Overview**

| Classification |  |
| --- | --- |
| MD5 | 8df1e0135851d1a0b66fbaa9be282009 |
| Main Behavior | Anti-debugging, Discord JavaScript injection (not actually executed), Discord backup code collection and transmission, Browser-related information collection and transmission, System-related information collection and transmission, Discord token collection and sensitive information collection and transmission using it, File information collection and transmission, Cryptocurrency address modulation through clipboard manipulation |
| Drop file | 0_1920x1080.png browsers folder and various collected information text file browser.zip files folder and collected files files.zip |
| C&C Server | hxxps[://]discord[.]com/api/webhooks/1101151106052145214/BIaHrwzWkurP1ifNTfI0S-nV_adpU3L7CtHkZgsoxNh0xWIhQpjX2fdzD9kB7BDNYQi7 hxxps[://]api[.]gofile[.]io (only for obtaining download URL after uploading files) |

# Analysis Result

## **Malware Behavior Flowchart**
![final.jpg]({{ '/assets/img/deathin/final.jpg' | relative_url}})

## **Executive summary**

This malware is a console-executable Info Stealer written in Go language, as shown in **Figure 1. malware analysis result on PEStudio**. The fact that it is executed as a CLI indicates that the malware is intended to be executed by an attacker who has obtained execution rights through RAT, and the reason why it is written in Go language is presumed to consider portability across various platforms.

![Figure 1. Malware analysis result on PEStudio](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image.png)

Figure 1. Malware analysis result on PEStudio

When the malware is executed, it first displays a fake error screen and performs an anti-debugging routine to check whether it is an analysis environment. If it is determined that it is not an analysis environment, it performs functions such as collecting code backup code (for the purpose of bypassing 2FA), browser-related sensitive information, victim system, code token, and code-related sensitive information and files. The collected results are formatted into a json message and sent to an address that is assumed to be the attacker's code URL, which may be attached to a code message or uploaded as a zip file to gofile.io and a download link is included in the json message for capacity reasons. This is followed by a continuous process of identifying cryptocurrency addresses in the clipboard and overwriting them with the attacker's desired address.

There is a function to browse the discord index.js and inject it by overwriting it with another malicious file, but it is not actually executed because the host URL to download the malicious presumed file is empty. Therefore, it is possible that this injection behavior is performed depending on the attacker's intention, and additional malicious behavior is possible depending on the form of the injected file.

## **Malware execution sequence**

1. Displays a fake error screen
2. Execute a function for anti-debugging
3. Execute multiple Go routines simultaneously
   - Attempt to bypass Discord protection mechanisms and inject Discord JavaScript
   - Collect various information related to the code
   - Collect various browser-related information
   - Collect various information about the user's system
   - Collect Discord token information
   - Collect file information
4. Attempts to modify cryptocurrency addresses through clipboard manipulation

## Analysis Details

### ***Preparing to analyze Golang malware***

- Since the decompilation results are very complex due to the nature of Golang malware, I used the Ghidra GolangAnalyzerExtension module to facilitate the analysis. It would be nice to have an IDA Pro license, but Ghidra seems to have released some good extensions. Figure 2 shows the GitHub where the GolangAnalyerExtension is available. Download the zip file from here and click File-Install Extensions on the Ghidra home screen as shown in Figure 3. Figure 4 will pop up, click the green + button on the top right and click the downloaded zip file to install it. After restarting Ghidra, select Analyze-One shot-Golang Analyzer from the Code explorer screen, and it will repair all the symbols and display main as shown in Figure 5. The better performance of GolangAnalyzerExtension over Goresym is evident by comparing Figure 6, where the symbols are recovered using Goresym alone, and Figure 5, where the symbols are recovered using GolangAnalyzerExtension.

![Figure 2. Ghidra_GolangAnalyzerExtension GitHub main screen](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%201.png)

Figure 2. Ghidra_GolangAnalyzerExtension GitHub main screen

![Figure 3. Install Extensions menu in the Ghidra main console](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%202.png)

Figure 3. Install Extensions menu in the Ghidra main console

![Figure 4. Popup window when selecting Install Extensions](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%203.png)

Figure 4. Popup window when selecting Install Extensions

![Figure 5. How to analyze with the extension after installing and restarting the extension.](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%204.png)

Figure 5. How to analyze with the extension after installing and restarting the extension.

![Figure 6. Restored result with Goresym alone](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%205.png)

Figure 6. Restored result with Goresym alone

### ***Go Routine: deadined/skuld/src/fakeerror.Run***

- The first routine that the malware assumes and executes is to display a fake error screen on the user's screen. It uses the Windows API, MessageBoxW function, and as you can see in Figure 7, the message is hardcoded in advance. When you run the function, you will see the window shown in Figure 8.

![Figure 7. Pre-hardcoded error window message on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%206.png)

Figure 7. Pre-hardcoded error window message on Ghidra CodeBrowser

![Figure 8. fake error warning window displayed when running the fakeerror function](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%207.png)

Figure 8. fake error warning window displayed when running the fakeerror function

### ***deathined/skuld/src/antidebug.Run()***

- The Run routine for anti-debugging is then executed, and as shown in Figure 9, it checks USERNAME, COMPUTERNAME, HWID, IP, MAC, registry values, and has the ability to kill specific processes. After this filtering process, if any blacklisted data is identified, the malware process is terminated via os.Exit.

![Figure 9. Subroutines for anti-debugging in the antidebug.Run function in Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%208.png)

Figure 9. Subroutines for anti-debugging in the antidebug.Run function in Ghidra CodeBrowser

- The first anti-debugging routine checks the account name.

![Figure 10. Username checking routine in the isBlackListedUser function in Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%209.png)

Figure 10. Username checking routine in the isBlackListedUser function in Ghidra CodeBrowser

| WDAGUtilityAccount | Abby | hmarc | patex |
| --- | --- | --- | --- |
| RDhJ0CNFevzX | kEecfMwgj | Fran | 8Nl0ColNQ5bq |
| Lisa | John | george | PxmdUOpVyx |
| 8VizSM | w0fjuOVmCcP5A | lmVwjj9b | PqONjHVwexsS |
| 3u2v9m8 | Julia | HEUeRzl | fred |
| server | BvJChRP | Harry Johnson | SqgFOf3G |
| Lucas | mike | PateX | h7dk1xPr |
| Louise | User01 | test | RGzcBUyrznReg |
| Robert | Peter Wilson | JOHN-PC |  |

Table 1. Blacklisted usernames

- The second anti-debugging routine checks the computer name.

![Figure 11. Computer name checking routine in the isBlackListedPC function on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2010.png)

Figure 11. Computer name checking routine in the isBlackListedPC function on Ghidra CodeBrowser

| 0CC47AC83803 | azure-PC | BEE7370C-8C0C-4 | DESKTOP-NAKFFMT | WIN-5E07COS9ALR |
| --- | --- | --- | --- | --- |
| B30F0242-1C6A-4 | DESKTOP-VRSQLAG | Q9IATRKPRH | XC64ZB | DESKTOP-D019GDM |
| DESKTOP-WI8CLET | SERVER1 | LISA-PC | JOHN-PC | DESKTOP-B0T93D6 |
| DESKTOP-1PYKP29 | DESKTOP-1Y2433R | WILEYPC | WORK | 6C4E733F-C2D9-4 |
| RALPHS-PC | DESKTOP-WG3MYJS | DESKTOP-7XC6GEZ | DESKTOP-5OV9S0O | QarZhrdBpj |
| ORELEEPC | ARCHIBALDPC | JULIA-PC | d1bnJkfVlH | NETTYPC |
| DESKTOP-BUGIO | desktop-cbgpfee | SERVER-PC | TIQIYLA9TW5M | DESKTOP-KALVINO |
| COMPNAME_4047 | DESKTOP-19OLLTD | DESKTOP-DE369SE | ea8c2e2a-d017-4 | AIDANPC |
| LUCAS-PC | MARCI-PC | ACEPC | MIKE-PC | DESKTOP-IAPKN1P |
| DESKTOP-NTU7VUO | LOUISE-PC | T00917 | test42 | DESKTOP-CDLNVOQ |

Table 2. List of blacklisted computer names

- The third anti-debugging routine checks the HWID.

![Figure 12. Routine in the isBlackListedHWID function on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2011.png)

Figure 12. Routine in the isBlackListedHWID function on Ghidra CodeBrowser

| 7AB5C494-39F5-4941-9163-47F54D6D5016 | 03DE0294-0480-05DE-1A06-350700080009 | 11111111-2222-3333-4444-555555555555 |
| --- | --- | --- |
| 6F3CA5EC-BEC9-4A4D-8274-11168F640058 | ADEEEE9E-EF0A-6B84-B14B-B83A54AFC548 | 4C4C4544-0050-3710-8058-CAC04F59344A |
| 00000000-0000-0000-0000-AC1F6BD04972 | 00000000-0000-0000-0000-000000000000 | 5BD24D56-789F-8468-7CDC-CAA7222CC121 |
| 49434D53-0200-9065-2500-65902500E439 | 49434D53-0200-9036-2500-36902500F022 | 777D84B3-88D1-451C-93E4-D235177420A7 |
| 49434D53-0200-9036-2500-369025000C65 | B1112042-52E8-E25B-3655-6A4F54155DBF | 00000000-0000-0000-0000-AC1F6BD048FE |
| EB16924B-FB6D-4FA1-8666-17B91F62FB37 | A15A930C-8251-9645-AF63-E45AD728C20C | 67E595EB-54AC-4FF0-B5E3-3DA7C7B547E3 |
| C7D23342-A5D4-68A1-59AC-CF40F735B363 | 63203342-0EB0-AA1A-4DF5-3FB37DBB0670 | 44B94D56-65AB-DC02-86A0-98143A7423BF |
| 6608003F-ECE4-494E-B07E-1C4615D1D93C | D9142042-8F51-5EFF-D5F8-EE9AE3D1602A | 49434D53-0200-9036-2500-369025003AF0 |
| 8B4E8278-525C-7343-B825-280AEBCD3BCB | 4D4DDC94-E06C-44F4-95FE-33A1ADA5AC27 | 79AF5279-16CF-4094-9758-F88A616D81B4 |
| FF577B79-782E-0A4D-8568-B35A9B7EB76B | 08C1E400-3C56-11EA-8000-3CECEF43FEDE | 6ECEAF72-3548-476C-BD8D-73134A9182C8 |
| 49434D53-0200-9036-2500-369025003865 | 119602E8-92F9-BD4B-8979-DA682276D385 | 12204D56-28C0-AB03-51B7-44A8B7525250 |
| 63FA3342-31C7-4E8E-8089-DAFF6CE5E967 | 365B4000-3B25-11EA-8000-3CECEF44010C | D8C30328-1B06-4611-8E3C-E433F4F9794E |
| 00000000-0000-0000-0000-50E5493391EF | 00000000-0000-0000-0000-AC1F6BD04D98 | 4CB82042-BA8F-1748-C941-363C391CA7F3 |
| B6464A2B-92C7-4B95-A2D0-E5410081B812 | BB233342-2E01-718F-D4A1-E7F69D026428 | 9921DE3A-5C1A-DF11-9078-563412000026 |
| CC5B3F62-2A04-4D2E-A46C-AA41B7050712 | 00000000-0000-0000-0000-AC1F6BD04986 | C249957A-AA08-4B21-933F-9271BEC63C85 |
| BE784D56-81F5-2C8D-9D4B-5AB56F05D86E | ACA69200-3C4C-11EA-8000-3CECEF4401AA | 3F284CA4-8BDF-489B-A273-41B44D668F6D |
| BB64E044-87BA-C847-BC0A-C797D1A16A50 | 2E6FB594-9D55-4424-8E74-CE25A25E36B0 | 42A82042-3F13-512F-5E3D-6BF4FFFD8518 |
| 38AB3342-66B0-7175-0B23-F390B3728B78 | 48941AE9-D52F-11DF-BBDA-503734826431 | 032E02B4-0499-05C3-0806-3C0700080009 |
| DD9C3342-FB80-9A31-EB04-5794E5AE2B4C | E08DE9AA-C704-4261-B32D-57B2A3993518 | 07E42E42-F43D-3E1C-1C6B-9C7AC120F3B9 |
| 88DC3342-12E6-7D62-B0AE-C80E578E7B07 | 5E3E7FE0-2636-4CB7-84F5-8D2650FFEC0E | 96BB3342-6335-0FA8-BA29-E1BA5D8FEFBE |
| 0934E336-72E4-4E6A-B3E5-383BD8E938C3 | 12EE3342-87A2-32DE-A390-4C2DA4D512E9 | 38813342-D7D0-DFC8-C56F-7FC9DFE5C972 |
| 8DA62042-8B59-B4E3-D232-38B29A10964A | 3A9F3342-D1F2-DF37-68AE-C10F60BFB462 | F5744000-3C78-11EA-8000-3CECEF43FEFE |
| FA8C2042-205D-13B0-FCB5-C5CC55577A35 | C6B32042-4EC3-6FDF-C725-6F63914DA7C7 | FCE23342-91F1-EAFC-BA97-5AAE4509E173 |
| CF1BE00F-4AAF-455E-8DCD-B5B09B6BFA8F | 050C3342-FADD-AEDF-EF24-C6454E1A73C9 | 4DC32042-E601-F329-21C1-03F27564FD6C |
| DEAEB8CE-A573-9F48-BD40-62ED6C223F20 | 05790C00-3B21-11EA-8000-3CECEF4400D0 | 5EBD2E42-1DB8-78A6-0EC3-031B661D5C57 |
| 9C6D1742-046D-BC94-ED09-C36F70CC9A91 | 907A2A79-7116-4CB6-9FA5-E5A58C4587CD | A9C83342-4800-0578-1EE8-BA26D2A678D2 |
| D7382042-00A0-A6F0-1E51-FD1BBF06CD71 | 1D4D3342-D6C4-710C-98A3-9CC6571234D5 | CE352E42-9339-8484-293A-BD50CDC639A5 |
| 60C83342-0A97-928D-7316-5F1080A78E72 | 02AD9898-FA37-11EB-AC55-1D0C0A67EA8A | DBCC3514-FA57-477D-9D1F-1CAF4CC92D0F |
| FED63342-E0D6-C669-D53F-253D696D74DA | 2DD1B176-C043-49A4-830F-C623FFB88F3C | 4729AEB0-FC07-11E3-9673-CE39E79C8A00 |
| 84FE3342-6C67-5FC6-5639-9B3CA3D775A1 | DBC22E42-59F7-1329-D9F2-E78A2EE5BD0D | CEFC836C-8CB1-45A6-ADD7-209085EE2A57 |
| A7721742-BE24-8A1C-B859-D7F8251A83D3 | 3F3C58D1-B4F2-4019-B2A2-2A500E96AF2E | D2DC3342-396C-6737-A8F6-0C6673C1DE08 |
| EADD1742-4807-00A0-F92E-CCD933E9D8C1 | AF1B2042-4B90-0000-A4E4-632A1C8C7EB1 | FE455D1A-BE27-4BA4-96C8-967A6D3A9661 |
| 921E2042-70D3-F9F1-8CBD-B398A21F89C6 |  |  |

Table 3. List of blacklisted HWIDs

- Next, we check the public IP of the execution environment by sending a Get request to hxxps[://]api[.]ipify[.]org and compare it with the blacklisted IP, and also check the MAC address.

![Figure 13. Routine for checking public IP and MAC address on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2012.png)

Figure 13. Routine for checking public IP and MAC address on Ghidra CodeBrowser

![Figure 14. Ghidra CodeBrowser blacklist IP checking routine](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2013.png)

Figure 14. Ghidra CodeBrowser blacklist IP checking routine

![Figure 15. Routine for checking MAC addresses on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2014.png)

Figure 15. Routine for checking MAC addresses on Ghidra CodeBrowser

| 109[.]145[.]173[.]169 | 109[.]74[.]154[.]90 | 109[.]74[.]154[.]91 | 109[.]74[.]154[.]92 | 178[.]239[.]165[.]70 |
| --- | --- | --- | --- | --- |
| 188[.]105[.]91[.]116 | 188[.]105[.]91[.]143 | 188[.]105[.]91[.]173 | 192[.]211[.]110[.]74 | 192[.]40[.]57[.]234 |
| 192[.]87[.]28[.]103 | 193[.]128[.]114[.]45 | 193[.]225[.]193[.]201 | 194[.]154[.]78[.]160 | 195[.]181[.]175[.]105 |
| 195[.]239[.]51[.]3 | 195[.]239[.]51[.]59 | 195[.]74[.]76[.]222 | 20[.]99[.]160[.]173 | 212[.]119[.]227[.]151 |
| 212[.]119[.]227[.]167 | 213[.]33[.]142[.]50 | 23[.]128[.]248[.]46 | 34[.]105[.]0[.]27 | 34[.]105[.]183[.]68 |
| 34[.]105[.]72[.]241 | 34[.]138[.]96[.]23 | 34[.]141[.]146[.]114 | 34[.]141[.]245[.]25 | 34[.]142[.]74[.]220 |
| 34[.]145[.]195[.]58 | 34[.]145[.]89[.]174 | 34[.]253[.]248[.]228 | 34[.]83[.]46[.]130 | 34[.]85[.]243[.]241 |
| 34[.]85[.]253[.]170 | 35[.]192[.]93[.]107 | 35[.]199[.]6[.]13 | 35[.]229[.]69[.]227 | 35[.]237[.]47[.]12 |
| 64[.]124[.]12[.]162 | 78[.]139[.]8[.]50 | 79[.]104[.]209[.]33 | 80[.]211[.]0[.]97 | 84[.]147[.]54[.]113 |
| 84[.]147[.]62[.]12 | 87[.]166[.]50[.]213 | 88[.]132[.]225[.]100 | 88[.]132[.]226[.]203 | 88[.]132[.]227[.]238 |
| 88[.]132[.]231[.]71 | 88[.]153[.]199[.]169 | 92[.]211[.]109[.]160 | 92[.]211[.]192[.]144 | 92[.]211[.]52[.]62 |
| 92[.]211[.]55[.]199 | 93[.]216[.]75[.]209 | 95[.]25[.]25[.]204[.]90 | 95[.]25[.]81[.]24 |  |

Table 4. List of Blacklisted IP Addresses

| 00:03:47:63:8b:de | 00:0c:29:05:d8:6e | 00:0c:29:2c:c1:21 | 00:0c:29:52:52:52:50 | 00:0d:3a:d2:4f:1f | 00:15:5d:00:00:1d |
| --- | --- | --- | --- | --- | --- |
| 00:15:5d:00:00:00:a4 | 00:15:5d:00:00:00:b3 | 00:15:5d:00:00:00:c3 | 00:15:5d:00:00:00:f3 | 00:15:5d:00:01:81 | 00:15:5d:00:02:26 |
| 00:15:5d:00:05:8d | 00:15:5d:00:05:d5 | 00:15:5d:00:06:43 | 00:15:5d:00:07:34 | 00:15:5d:00:1a:b9 | 00:15:5d:00:1c:9a |
| 00:15:5d:13:66:ca | 00:15:5d:13:6d:0c | 00:15:5d:1e:01:c8 | 00:15:5d:23:4c:a3 | 00:15:5d:23:4c:ad | 00:15:5d:b6:e0:cc |
| 00:1b:21:13:13:15:20 | 00:1b:21:13:21:26 | 00:1b:21:13:26:44 | 00:1b:21:13:32:20 | 00:1b:21:13:32:51 | 00:1b:21:13:33:55 |
| 00:23:cd:ff:94:f0 | 00:25:90:36:65:0c | 00:25:90:36:65:38 | 00:25:90:36:f0:3b | 00:25:90:65:39:e4 | 00:50:56:97:a1:f8 |
| 00:50:56:97:ec:f2 | 00:50:56:97:f6:c8 | 00:50:56:a0:06:8d | 00:50:56:a0:38:06 | 00:50:56:a0:39:18 | 00:50:56:a0:45:03 |
| 00:50:56:a0:59:10 | 00:50:56:a0:61:aa | 00:50:56:a0:6d:86 | 00:50:56:a0:84:88 | 00:50:56:a0:af:75 | 00:50:56:a0:cd:a8 |
| 00:50:56:a0:d0:fa | 00:50:56:a0:d7:38 | 00:50:56:a0:dd:00 | 00:50:56:ae:5d:ea | 00:50:56:ae:6f:54 | 00:50:56:ae:b2:b0 |
| 00:50:56:ae:e5:d5 | 00:50:56:b3:05:b4 | 00:50:56:b3:09:9e | 00:50:56:b3:14:59 | 00:50:56:b3:21:29 | 00:50:56:b3:38:68 |
| 00:50:56:b3:38:88 | 00:50:56:b3:3b:a6 | 00:50:56:b3:42:33 | 00:50:56:b3:4c:bf | 00:50:56:b3:50:de | 00:50:56:b3:91:c8 |
| 00:50:56:b3:94:cb | 00:50:56:b3:9e:9e | 00:50:56:b3:d0:a7 | 00:50:56:b3:dd:03 | 00:50:56:b3:ea:ee | 00:50:56:b3:ee:e1 |
| 00:50:56:b3:f6:57 | 00:50:56:b3:fa:23 | 00:e0:4c:44:76:54 | 00:e0:4c:46:cf:01 | 00:e0:4c:4b:4a:40 | 00:e0:4c:56:42:97 |
| 00:e0:4c:7b:7b:86 | 00:e0:4c:94:1f:20 | 00:e0:4c:b3:5a:2a | 00:e0:4c:b8:7a:58 | 00:e0:4c:cb:62:08 | 00:e0:4c:d6:86:77 |
| 06:75:91:59:3e:02 | 08:00:27:3a:28:73 | 08:00:27:45:13:10 | 12:1b:9e:3c:a6:2c | 12:8a:5c:2a:65:d1 | 12:f8:87:ab:13:ec |
| 16:ef:22:04:af:76 | 1a:6c:62:60:3b:f4 | 1c:99:57:1c:ad:e4 | 1e:6c:34:93:68:64 | 2e:62:e8:47:14:49 | 2e:b8:24:4d:f7:de |
| 32:11:4d:d0:4a:9e | 3c:ec:ef:43:fe:de | 3c:ec:ef:44:00:d0 | 3c:ec:ef:44:01:0c | 3c:ec:ef:44:01:aa | 3e:53:81:b7:01:13 |
| 3e:c1:fd:f1:bf:71 | 42:01:0a:8a:00:22 | 42:01:0a:8a:00:33 | 42:01:0a:8e:00:22 | 42:01:0a:96:00:22 | 42:01:0a:96:00:33 |
| 42:85:07:f4:83:d0 | 4e:79:c0:d9:af:c3 | 4e:81:81:8e:22:4e | 52:54:00:3b:78:24 | 52:54:00:8b:a6:08 | 52:54:00:a0:41:92 |
| 52:54:00:ab:de:59 | 52:54:00:b3:e4:71 | 56:b0:6f:ca:0a:e7 | 56:e8:92:2e:76:0d | 5a:e2:a6:a4:44:db | 5e:86:e4:3d:0d:f6 |
| 60:02:92:3d:f1:69 | 60:02:92:66:10:79 | 7e:05:a3:62:9c:4d | 90:48:9a:9d:d5:24 | 92:4c:a8:23:fc:2e | 94:de:80:de:1a:35 |
| 96:2b:e9:43:96:76 | a6:24:aa:ae:e6:12 | ac:1f:6b:d0:48:fe | ac:1f:6b:d0:49:86 | ac:1f:6b:d0:4d:98 | ac:1f:6b:d0:4d:e4 |
| b4:a9:5a:b1:c6:fd | b6:ed:9d:27:f4:fa | be:00:e5:c5:0c:e5 | c2:ee:af:fd:29:21 | c8:9f:1d:b6:58:e4 | ca:4d:4b:ca:18:cc |
| d4:81:d7:87:05:ab | d4:81:d7:ed:25:54 | d6:03:e4:ab:77:8e | ea:02:75:3c:90:9f | ea:f6:f1:a2:33:76 | f6:a5:41:31:b2:78 |

Table 5. List of Blacklisted MAC Addresses

- The fifth anti-debugging routine checks the screen size and exits if it is less than a certain size (200x200).

![Figure 16. Screen Size Check Routine on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2015.png)

Figure 16. Screen Size Check Routine on Ghidra CodeBrowser

- The sixth anti-debugging routine checks for a suspicious environment, which checks the RAM size to see if it is more than 2 GB.

![Figure 17. Memory size check routine on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2016.png)

Figure 17. Memory size check routine on Ghidra CodeBrowser

- The seventh anti-debugging routine checks the registry to see if a program is running in a virtual environment. At this time, the graphics driver name and disk device string are checked, and if there is a VMware or VBOX string, the analysis environment is determined.

![Figure 18. Routine for checking the registry on Ghidra CodeBrowser to detect virtual environments](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2017.png)

Figure 18. Routine for checking the registry on Ghidra CodeBrowser to detect virtual environments

![Figure 19 [.](https://learn.microsoft.com/en-us/windows-hardware/drivers/install/system-defined-device-setup-classes-available-to-vendors)The {4D36E968-E325-11CE-BFC1-08002BE10318} class described on [https://learn.microsoft.com/en-us/windows-hardware/drivers/install/system-defined-device-setup-classes-available-to-vendors](https://learn.microsoft.com/en-us/windows-hardware/drivers/install/system-defined-device-setup-classes-available-to-vendors)](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2018.png)

Figure 19 [.](https://learn.microsoft.com/en-us/windows-hardware/drivers/install/system-defined-device-setup-classes-available-to-vendors)The {4D36E968-E325-11CE-BFC1-08002BE10318} class described on [https://learn.microsoft.com/en-us/windows-hardware/drivers/install/system-defined-device-setup-classes-available-to-vendors](https://learn.microsoft.com/en-us/windows-hardware/drivers/install/system-defined-device-setup-classes-available-to-vendors)

- The final part of the anti-debugging routine is to kill specific processes.

![Figure 20. Process termination routine in the KillProcesses function on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2019.png)

Figure 20. Process termination routine in the KillProcesses function on Ghidra CodeBrowser

| VGAuthService | cmd | dbg | debuger | debugger | df5serv |
| --- | --- | --- | --- | --- | --- |
| diskmon | dumper | fiddler | hacker | http | httpdebuggerui |
| ida | ida64 | joeboxcontrol | joeboxserver | ksdumper | ksdumperclient |
| ollydbg | packet | pestudio | prl | prl-cc | prl-tools |
| processhacker | procmon | qemu-ga | regedit | regmon | taskgr |
| traffic | vboxservice | vboxtray | vgauthservice | vmacthlp | vmsrvc |
| vmtoolsd | vmusrvc | vmwaretray | vmwareuser | wireshark | x32dbg |
| x96dbg | xenservice |  |  |  |  |

Table 6. List of processes to terminate

- Next, we create several Go routines to execute the routines shown in Figure 21 in parallel. Because these are separate and concurrent Go routines, they are executed simultaneously without waiting for each routine to return.

![Figure 21. Go routines on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2020.png)

Figure 21. Go routines on Ghidra CodeBrowser

### ***Go Routine: diedined/skuld/src/injection.Run***

- The first Go routine, Run, is for code injection and initially bypasses code security tools if they exist.

![Figure 22. BetterDiscord and DiscordTokenProtector bypass routine in injection.Run function on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2021.png)

Figure 22. BetterDiscord and DiscordTokenProtector bypass routine in injection.Run function on Ghidra CodeBrowser

- It then checks the existence of the discord directory and executes the injection routine, as shown in Figure 23.

![Figure 23. Checking the Discord directory and injectDiscord routine in the injection.Run function on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2022.png)

Figure 23. Checking the Discord directory and injectDiscord routine in the injection.Run function on Ghidra CodeBrowser

![Figure 24. Discord directory on x64dbg](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2023.png)

Figure 24. Discord directory on x64dbg

- In the injection routine, a getCore routine is executed to find the discord_desktop_core folder where js is located in the Discord directory, and once found, an http request, read, and overwrite routine is expected to be executed to modify index.js into a malicious index.js.

![Figure 25. Routines within the injectDiscord function on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2024.png)

Figure 25. Routines within the injectDiscord function on Ghidra CodeBrowser

![Figure 26. Traversing the discord_desktop_core folder by the getCore function on x64dbg](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2025.png)

Figure 26. Traversing the discord_desktop_core folder by the getCore function on x64dbg

![Figure 27. Injection target file (index.js) inside the discord_desktop_core folder](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2026.png)

Figure 27. Injection target file (index.js) inside the discord_desktop_core folder

- However, in the case of this routine, the data corresponding to the host_url is empty, so the HTTP GET request is not actually made.

![Figure 28. host_url, the third argument of net/http.(*Client).Get() function with no data on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2027.png)

Figure 28. host_url, the third argument of net/http.(*Client).Get() function with no data on Ghidra CodeBrowser

![Figure 29. RCX (host_url) is zeroed out even between dynamic analysis on x64dbg](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2028.png)

Figure 29. RCX (host_url) is zeroed out even between dynamic analysis on x64dbg

### ***Go Routine: diedined/skuld/src/discodes.Run***

- The next Go routine, Run, traverses through the file directories to find discord_backup_codes, as shown in Figure 32. Once found, it sends the data to a specific Discord URL via a webhook. Here, the data in discord_backup_codes is formatted into json format using map[string]interface_{}, as shown in Figure 33, which is often used by other Go routines to steal information.

![Figure 30. Routine in discords.Run function for collecting data on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2029.png)

Figure 30. Routine in discords.Run function for collecting data on Ghidra CodeBrowser

![Figure 31. List of identified browsable folders on x64dbg](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2030.png)

Figure 31. List of identified browsable folders on x64dbg

![Figure 32. Identified browse target file on x64dbg: discord_backup_codes](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2031.png)

Figure 32. Identified browse target file on x64dbg: discord_backup_codes

![Figure 33. Routine for generating data in json file format for sending webhooks on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2032.png)

Figure 33. Routine for generating data in json file format for sending webhooks on Ghidra CodeBrowser

![Figure 34. Discord webhook: Sending data as HTTP POST request to Discord address (hxxps[://]discord[.]com/api/webhooks/1101151106052145214/BIaHrwzWkurP1ifNTfI0S-nV_adpU3L7CtHkZgsoxNh0xWIhQpjX2fdzD9kB7BDNYQi7)](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2033.png)

Figure 34. Discord webhook: Sending data as HTTP POST request to Discord address (hxxps[://]discord[.]com/api/webhooks/1101151106052145214/BIaHrwzWkurP1ifNTfI0S-nV_adpU3L7CtHkZgsoxNh0xWIhQpjX2fdzD9kB7BDNYQi7)

### ***Go Routine: diedined/skuld/src/browsers.Run***

- The following Go routine, Run, checks for the existence of Gecko-based and Chromium-based web browsers, steals the master key if present, and performs routines to steal various browser-related information.

![Figure 35. Ghidra CodeBrowser's browser.Run function's Gecko and Chromium-based browser master key capture, information collection, and file compression routines.](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2034.png)

Figure 35. Ghidra CodeBrowser's browser.Run function's Gecko and Chromium-based browser master key capture, information collection, and file compression routines.

![Figure 36. Information gathering routine in chromium.Steal() function on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2035.png)

Figure 36. Information gathering routine in chromium.Steal() function on Ghidra CodeBrowser

- Based on the Chromium-based browser, find and read C:%USERPROFILE%AppData\\Local\\Google\\Chrome\\User Data\Local State as shown in Figure 37. The Local State is equal to **Error! Reference source not found**, of which we get the value of the encrypted_key key as shown in Figure 39 to obtain the masterkey by Base64 decoding and then decrypting via DPAPI.

![Figure 37. Local State navigation routine on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2036.png)

Figure 37. Local State navigation routine on Ghidra CodeBrowser

![Figure 38. Local State contents (partially obscured for security reasons)](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2037.png)

Figure 38. Local State contents (partially obscured for security reasons)

![Figure 39. Masterkey base64 decoding and DPAPI decryption routine on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2038.png)

Figure 39. Masterkey base64 decoding and DPAPI decryption routine on Ghidra CodeBrowser

- Next, based on the obtained masterkey, the GetLoginData, GetCreditCardData, GetCookieData, GetHistoryData, and GetDownloadData routines collect the corresponding information. As shown in Figure 40, for Chromium-based browsers such as Opera or Opera GX, only the Default profile information is collected. Other Chromium-based browsers traverse all browser profiles to collect information, as shown in Figure 41.

![Figure 40. Routine to collect information only for the Default profile on Ghidra CodeBrowser. Parsing the condition of the If statement results in Opera or OperaGX.](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2039.png)

Figure 40. Routine to collect information only for the Default profile on Ghidra CodeBrowser. Parsing the condition of the If statement results in Opera or OperaGX.

![Figure 41. Routine to collect information for all profiles on Ghidra CodeBrowser. Note Current_profile + 2.](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2040.png)

Figure 41. Routine to collect information for all profiles on Ghidra CodeBrowser. Note Current_profile + 2.

- Gecko-based browsers collect information in a similar way, and the following Gecko and Chromium-based browsers perform the navigation respectively.

| Firefox | Waterfox | K-Meleon |
| --- | --- | --- |
| Thunderbird | Cyberfox | SeaMonkey |
| IceDragon | BlackHaw | Pale Moon |

Table 7. List of browsers targeted by Gecko

| Kometa | comodo | liebao | QIP Surf | CentBrowser |
| --- | --- | --- | --- | --- |
| Coowon | Orbitum | K-Melon | CocCoc | Amigo |
| Chrome | Citrio | Elements Browser | 360Browser | Torch |
| Chrome (x86) | Chedot | Chromium | Iridium | Edge |
| YandexBrowser | Opera Stable | Chrome SxS | Brave-Browser | Uran |
| Sleipnir5 | Vivaldi | Opera GX Stable | ChromePlus | Epic Privacy Browser |
| Maxthon3 | Sputnik | DCBrowser | 7Star |  |

Table 8. List of Chromium-based target browsers

- The collected information is organized and compressed in the browsers folder as shown in Figure 42, and then sent along with the json format data using the Webhook method described earlier. After the data is sent, the browser folder and zip are deleted, as shown in Figure 46.
- If the data exists, the files txt, creditcards.txt, cookies.txt, history.txt, and downloads.txt are created in the "browsers-browser-name-profile" folder. In Figure 45, we can see that Chrome and Edge browsers are present in the analysis environment, but only two text files are collected: history and downloads.

![Figure 42. Ghidra CodeBrowser creates directories and text files based on the collected information, and compresses the files.](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2041.png)

Figure 42. Ghidra CodeBrowser creates directories and text files based on the collected information, and compresses the files.

![Figure 43. Dropped browsers folder and browser.zip](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2042.png)

Figure 43. Dropped browsers folder and browser.zip

![Figure 44. Chrome and Edge folders present in the browsers folder](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2043.png)

Figure 44. Chrome and Edge folders present in the browsers folder

![Figure 45. text file with downloads, history information collected from the Default profile of the dropped Chrome browser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2044.png)

Figure 45. text file with downloads, history information collected from the Default profile of the dropped Chrome browser

![Figure 46. Routines to generate json format data, send webhooks, and delete files on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2045.png)

Figure 46. Routines to generate json format data, send webhooks, and delete files on Ghidra CodeBrowser

### ***Go Routine: deadined/skuld/src/system.Run***

- The following Go routine, Run, collects system information, and the information collected is screenshot, user data, system data, network data, and windows data.

![Figure 47. Various data collection functions in the system.Run function on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2046.png)

Figure 47. Various data collection functions in the system.Run function on Ghidra CodeBrowser

- The Screenshot routine checks the number of displays currently in operation, their size, and captures a screenshot of the current state and drops a png file with the screen size in the working directory.

![Figure 48. Display information collection and screenshot capture routine on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2047.png)

Figure 48. Display information collection and screenshot capture routine on Ghidra CodeBrowser

![Figure 49. Dropped screenshot png file](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2048.png)

Figure 49. Dropped screenshot png file

![Figure 50. Contents of the dropped screenshot file (0_1920x1080.png)](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2049.png)

Figure 50. Contents of the dropped screenshot file (0_1920x1080.png)

- The UserData routine collects the Host name and User name.

![Figure 51. Host and User name collection routine on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2050.png)

Figure 51. Host and User name collection routine on Ghidra CodeBrowser

- The SystemData routine collects CPU information including HWID, context, virtual memory information including context, GPU information, etc.

![Figure 52. Ghidra CodeBrowser HWID, CPU, Virtual memory, GPU information collection routine](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2051.png)

Figure 52. Ghidra CodeBrowser HWID, CPU, Virtual memory, GPU information collection routine

- The NetworkData routine collects public IP address, MAC address, country, city, region, and zip code information.

![Figure 53. Ghidra CodeBrowser Public IP and MAC Information Collection Routine](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2052.png)

Figure 53. Ghidra CodeBrowser Public IP and MAC Information Collection Routine

![Figure 54. Routine to collect country, city, region, zip code, etc. information on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2053.png)

Figure 54. Routine to collect country, city, region, zip code, etc. information on Ghidra CodeBrowser

- WindowsData utilizes Powershell commands to collect Windows information, including product key and product name.

![Figure 55. Product key and product name collection routine using powershell on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2054.png)

Figure 55. Product key and product name collection routine using powershell on Ghidra CodeBrowser

![Figure 56. Identified product key on x64dbg](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2055.png)

Figure 56. Identified product key on x64dbg

![Figure 57. Identified product name on x64dbg](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2056.png)

Figure 57. Identified product name on x64dbg

- All the collected information is written in JSON format and sent to the webhook along with the screenshot file, and similarly, the PNG file is deleted.

![Figure 58. Routine for sending webhook and deleting png file on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2057.png)

Figure 58. Routine for sending webhook and deleting png file on Ghidra CodeBrowser

### ***Go Routine: diedined/skuld/src/tokens.Run***

- The following Go routine, Run, traverses the Chromium and Gecko browsers to collect tokens. The Chromium browsers it traverses are

| Kometa | comodo | liebao | QIP Surf | CentBrowser |
| --- | --- | --- | --- | --- |
| Coowon | Orbitum | K-Melon | CocCoc | Amigo |
| Chrome | Citrio | Elements Browser | 360Browser | Torch |
| Chrome (x86) | Chedot | Chromium | Iridium | Edge |
| YandexBrowser | Opera Stable | Chrome SxS | Brave-Browser | Uran |
| Sleipnir5 | Vivaldi | Opera GX Stable | ChromePlus | Epic Privacy Browser |
| Maxthon3 | Sputnik | DCBrowser | 7Star |  |

Table 9. List of browsers targeted for Chromium-based navigation

- If the browser directory exists, check whether %USERPROFILE%Local Storage\Local State or %USERPROFILE%Local Data\Local State exists.

![Figure 59. Routine to explore User Data\Local State or Local Data\Local State on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2058.png)

Figure 59. Routine to explore User Data\Local State or Local Data\Local State on Ghidra CodeBrowser

- If it exists, find and read the .log or .ldb file.

![Figure 60. Routine to browse .log or .ldb file on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2059.png)

Figure 60. Routine to browse .log or .ldb file on Ghidra CodeBrowser

- After searching for the cord string in the read data, the token is searched using different regular expressions if the string exists and if it does not exist. If the cord string is present, the token is Base64 decoded and then decrypted, as shown in the Base64 decode and decrypt routine for the token identified in Figure Ghidra CodeBrowser.

![Figure 61. cord string detection routine from read data on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2060.png)

Figure 61. cord string detection routine from read data on Ghidra CodeBrowser

![Figure 62. Searching for a disco token using a regular expression ([\\w-]{26}\\.[\\w-]{6}\\.[\\w-]{25,110}|mfa\\.[\\w-]{80,95}) in the absence of a string](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2061.png)

Figure 62. Searching for a disco token using a regular expression ([\\w-]{26}\\.[\\w-]{6}\\.[\\w-]{25,110}|mfa\\.[\\w-]{80,95}) in the absence of a string

![Figure 63. x64dbg-identified token detection regex when no cord string is present](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2062.png)

Figure 63. x64dbg-identified token detection regex when no cord string is present

![Figure 64. Detecting a discovery token utilizing a regex (dQw4w9WgXcQ:[^\\\"]) when the string is present](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2063.png)

Figure 64. Detecting a discovery token utilizing a regex (dQw4w9WgXcQ:[^\\\"]) when the string is present

![Figure 65. x64dbg-identified token detection regular expression (when cord string is present)](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2064.png)

Figure 65. x64dbg-identified token detection regular expression (when cord string is present)

![Figure 66. Base64 decoding and decryption routine for token identified by Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2065.png)

Figure 66. Base64 decoding and decryption routine for token identified by Ghidra CodeBrowser

- Once all the Chromium browsers have been explored, we traverse to the Gecko browsers. For a list of Gecko browsers to be explored, see

| Firefox | Waterfox | K-Meleon |
| --- | --- | --- |
| Thunderbird | Cyberfox | SeaMonkey |
| IceDragon | BlackHaw | Pale Moon |

 ****Table 10. Gecko browsers to be explored

- When the browsing and token information collection for all browsers is finished, execute the Upload function, which sends an HTTP GET request to the hxxps[://]discord[.]com/api/v9/users/@me address with the previously collected token value in the Authorization header key in the request header. In response, we receive a User Object as shown in Figure 68, Figure 69, and Figure 70.

![Figure 67. Routine for sending HTTP GET request with token to hxxps[://]discord[.]com/api/v9/users/@me in Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2066.png)

Figure 67. Routine for sending HTTP GET request with token to hxxps[://]discord[.]com/api/v9/users/@me in Ghidra CodeBrowser

![Figure 68. User Structure of the User Object, from [https://discord.com/developers/docs/resources/user#user-object](https://discord.com/developers/docs/resources/user#user-object)](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2067.png)

Figure 68. User Structure of the User Object, from [https://discord.com/developers/docs/resources/user#user-object](https://discord.com/developers/docs/resources/user#user-object)

![Figure 69. User Flags in User Object, from [https://discord.com/developers/docs/resources/user#user-object](https://discord.com/developers/docs/resources/user#user-object)](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2068.png)

Figure 69. User Flags in User Object, from [https://discord.com/developers/docs/resources/user#user-object](https://discord.com/developers/docs/resources/user#user-object)

![Figure 70. Premium Types in User Object, from [https://discord.com/developers/docs/resources/user#user-object](https://discord.com/developers/docs/resources/user#user-object)](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2069.png)

Figure 70. Premium Types in User Object, from [https://discord.com/developers/docs/resources/user#user-object](https://discord.com/developers/docs/resources/user#user-object)

- In the same way, send an HTTP GET request with a token to hxxps[://]discord[.]com/api/v9/users/@me/billing/payment-sources and get the Discord payment information in response

![Figure 71. Routine to get payment information in Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2070.png)

Figure 71. Routine to get payment information in Ghidra CodeBrowser

- Get guild information from hxxps[://]discord[.]com/api/v9/users/@me/guilds?with_counts=true

![Figure 72. Routine to get guild information in Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2071.png)

Figure 72. Routine to get guild information in Ghidra CodeBrowser

- Get friend information from hxxps[://]discord[.]com/api/v9/users/@me/relationships

![Figure 73. Routine to get friend information in Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2072.png)

Figure 73. Routine to get friend information in Ghidra CodeBrowser

- Get avatar information from hxxps[://]cdn[.]discordapp[.]com/avatars/

![Figure 74. Routine to get avatar information in Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2073.png)

Figure 74. Routine to get avatar information in Ghidra CodeBrowser

- All the collected information is written in json format and sent to the Discord URL described earlier via Webhooks

### ***Go Routine: diedined/skuld/src/files.Run***

- The next Go Routine, Run, traverses the C drive and finds and copies all the files with the targeted extension, which it captures by utilizing Go file upload and webhooks. The routine first creates a folder named files in the working directory.

![Figure 75. Routine to create the files directory in Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2074.png)

Figure 75. Routine to create the files directory in Ghidra CodeBrowser

![Figure 76. Dropped files folder in the working directory (desktop)](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2075.png)

Figure 76. Dropped files folder in the working directory (desktop)

- It then traverses the Desktop, Documents, Downloads, Pictures, Music, Video, and OneDrive folders in %USERPROFILE% of the C drive and collects all files with the desired extensions. The targeted extensions are shown in Table **10**. List of target extensions for file browsing and collection.

![Figure 77. List of target folders for file browsing identified on x64dbg](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2076.png)

Figure 77. List of target folders for file browsing identified on x64dbg

| .doc | .exe | .gif | .htm | .html | .jpeg |
| --- | --- | --- | --- | --- | --- |
| .jpg | .json | .ldb | .log | .mjs | .mkv |
| .mp3 | .mp4 | .odt | .ogg | .pdf | .png |
| .ppt | .pptx | .rtf | .svg | .txt | .wav |
| .wasm | .webp | .xls | .xlsx | .xml |  |

Table 11. List of file detection and collection target extensions

- If the target extension matches, copy it to the files folder. In our analysis environment, we changed the target extension to .lnk and collected only .lnk files.

![Figure 78. Routine to copy files with target extensions to the files folder on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2077.png)

Figure 78. Routine to copy files with target extensions to the files folder on Ghidra CodeBrowser

![Figure 79. Files with the dropped target extension in the files folder](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2078.png)

Figure 79. Files with the dropped target extension in the files folder

- If the collected files exist in the files folder, create a zip file for file exfiltration.

![Figure 80. Routine to compress the files folder into a zip file on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2079.png)

Figure 80. Routine to compress the files folder into a zip file on Ghidra CodeBrowser

![Figure 81. files.zip dropped on the working directory (desktop)](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2080.png)

Figure 81. files.zip dropped on the working directory (desktop)

- Upload the zip file to a Go file using the GoFileUpload routine as shown in Figure 82. Inside the routine, send a GET request to api[.]gofile[.]io/getServer to get the server address, as shown in Figure 83. After that, upload the zip file with a POST request to the received address, as shown in Figure 85, and receive a download link in response.

![Figure 82. Executing the GoFileUpload function with files.zip as an argument in Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2081.png)

Figure 82. Executing the GoFileUpload function with files.zip as an argument in Ghidra CodeBrowser

![Figure 83. Routine for sending an HTTP GET request to api[.]gofile[.]io/getServer on Ghidra CodeBrowser and processing the response](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2082.png)

Figure 83. Routine for sending an HTTP GET request to api[.]gofile[.]io/getServer on Ghidra CodeBrowser and processing the response

![Figure 84. Description of api[.]gofile[.]io/servers in the gofile API documentation, from [https://gofile.io/api.](https://gofile.io/api)](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2083.png)

Figure 84. Description of api[.]gofile[.]io/servers in the gofile API documentation, from [https://gofile.io/api.](https://gofile.io/api)

![Figure 85. Routine for uploading zip file via POST request to Gofile on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2084.png)

Figure 85. Routine for uploading zip file via POST request to Gofile on Ghidra CodeBrowser

![Figure 86. Response packet structure for POST request to Go file server](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2085.png)

Figure 86. Response packet structure for POST request to Go file server

- Afterward, we create a webhook in json data format with a download link and a tree representing the folder structure and send it to Discord, and delete the zip file and the files folder.

![Figure 87. Writing transfer data in json format including download link](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2086.png)

Figure 87. Writing transfer data in json format including download link

![Figure 88. Webhook sending routine on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2087.png)

Figure 88. Webhook sending routine on Ghidra CodeBrowser

### ***deathined/skuld/src/clipper.Run()***

- The lastRun performed first watches the clipboard status through the clipboard.watch routine.

![Figure 89. The clipboard.watch function inside the clipper.Run function on Ghidra CodeBrowser.](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2088.png)

Figure 89. The clipboard.watch function inside the clipper.Run function on Ghidra CodeBrowser.

- The watch function creates a new Go routine through the clipboard.watch.fun1 function and creates a channel between the routines to send and receive data about the clipboard state.

![Figure 90. The clipboard.watch function routine on Ghidra CodeBrowser, running watch.func1 and receiving data through the channel.](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2089.png)

Figure 90. The clipboard.watch function routine on Ghidra CodeBrowser, running watch.func1 and receiving data through the channel.

- The watch.fun1 function runs the GetClipboardSequenceNumber function of the Windows API, USER32.dll module, to detect changes to the clipboard and sends this information to the parent Go routine via the channel.

![Figure 91. Calling Windows API, GetClipboardSenquenceNumber, on Ghidra CodeBrowser.](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2090.png)

Figure 91. Calling Windows API, GetClipboardSenquenceNumber, on Ghidra CodeBrowser.

![Figure 92. Windows API function GetClipboardSequenceNumber identified on x64dbg.](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2091.png)

Figure 92. Windows API function GetClipboardSequenceNumber identified on x64dbg.

- watch.fun1 repeatedly checks the Sequence Number of the clipboard to detect any changes to the clipboard, gets the contents of the clipboard, and sends this information to the parent Go routine via the same channel.

![Figure 93. The clipboard read routine in the clipboard.watch.func1 function on Ghidra CodeBrowser.](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2092.png)

Figure 93. The clipboard read routine in the clipboard.watch.func1 function on Ghidra CodeBrowser.

- Once a change to the clipboard has been detected, the parent Go routine traverses the regular expression to find the specific data. The types of regular expressions it traverses are shown in Table 12.

![Figure 94. Data traversal routine through regular expressions based on clipboard changes on Ghidra CodeBrowser.](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2093.png)

Figure 94. Data traversal routine through regular expressions based on clipboard changes on Ghidra CodeBrowser.

| ^(bc1|[13])[a-zA-HJ-NP-Z0-9]{25,39} | Bitcoin. |
| --- | --- |
| [LM3][a-km-zA-HJ-NP-Z1-9]{26,33} | Litecoin |
| ^0x[a-zA-F0-9]{40} | Ethereum |
| ^([P]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38} | Cardano |
| ^([X]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38} | DASH |
| addr1[a-z0-9]+ | Cardano |
| /X[1-9A-HJ-NP-Za-km-z]{33} | DASH |
| ^4([0-9]|[A-B])(.){93} | Monero |

Table 11. List of regular expressions used to explore target data, from https://publication.osintambition.org/20-regular-expressions-examples-to-search-for-data-related-to-cryptocurrencies-43e31dd4a5dc

- Once it finds a matching regular expression pattern, it finds random data that fits the regular expression and writes it to the clipboard. In other words, if a cryptocurrency address is copied and entered into the clipboard, clipper.Run will identify it and overwrite the cryptocurrency address that the attacker wants with the same regular expression instead of the cryptocurrency address that the victim copied. This means that the user will paste the cryptocurrency address that the attacker wants instead of the cryptocurrency address that the user wants.

![Figure 95. Routine to overwrite the clipboard with the attacker's desired data on Ghidra CodeBrowser](https://github.com/mango0727-github/josephjy.io/tree/master/assets/img/deathin/image%2094.png)

Figure 95. Routine to overwrite the clipboard with the attacker's desired data on Ghidra CodeBrowser

# Conclusion

- This malware can be executed through the console and is written in Golang. This suggests that the attacker may have already gained execution privileges with another malware, such as a RAT, and is attempting to run this malware via command line. In addition, since Golang is highly portable to Windows, Linux, and MacOS, it is possible that the attacker could conveniently carry out the attack by compiling differently depending on the target platform, rather than simply targeting Windows.
- The malware mainly utilizes vulnerabilities in the diskette to carry out malicious activities, and considering its main functions, it is thought to be an Info Stealer. In particular, this malware is characterized by stealing not only general data but also tokens or master keys to steal inaccessible information that requires authentication.
- In addition, the act of searching for data related to the cryptocurrency address among the data entered into the clipboard at the end of the execution and overwriting it with the data desired by the attacker seems to be an attempt to steal cryptocurrency by tampering with the clipboard during the copy/paste process for the user to paste the address desired by the attacker.
- The questionable part is that in the injection.Run part, there is code to get index.js via HTTP GET and overwrite it, but there is no Host URL data for the GET request. If the address of C2 had been entered, it would have been possible to replace index.js with malicious JS and inject it, and it would have been possible to use the victim's discord program for malicious activities.
